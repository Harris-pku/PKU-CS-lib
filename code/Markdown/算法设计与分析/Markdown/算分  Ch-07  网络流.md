#### 算分 Ch-07  网络流

##### 7.1 最大流

**定义  7. 1**    设有向连通图 $N = < V,E >$，记 $n = |V|$，$m = |E|$，对图中的每一条边 $<i,j>$ 都有一个非负实数 $c(i,j)$，称作边 $<i,j>$ 的**容量**。$N$ 有两个特殊的顶点 $s$ 和 $t$，$s$ 称为**源点**，$t$ 称为**汇点**，其余的顶点称作**中间点**，称 $N$ 为**容量网络**，记作 $N = <V,E,c,s,t>$.

​        设 $f:E \to R^*$，其中 $R^*$ 是非负实数集，满足

1.  容量限制  $\forall <i,j>$ $\in E$，$f(i,j) \leq c(i,j)$.
2.  平衡条件 $\forall$ $i \in V-\{s, t \}$，$\displaystyle \sum _ {<j,i> \in  E} f(j, i) = \displaystyle \sum _ {<i,j> \in E}f(i,j)$.

称 $f$ 是 $N$ 上的一个**可行流**，称源点 $s$ 的净流出量为 $f$ 的**流量**，记作 $v(f)$，即
$$
v(f)=\displaystyle \sum _ {<s,j> \in  E} f(s, j) - \displaystyle \sum _ {<j,s> \in E}f(j,s) \tag{7. 1}
$$
流量最大的可行流称为**最大流**。
$$
v(f)=\displaystyle \sum _ {<j, t> \in  E} f(j, t) - \displaystyle \sum _ {<t, j> \in E} f(t, j) \tag{7. 2}
$$
**最大流问题**    求给定容量网络上的最大流

**定义  7. 2**    设容量网络 $N = <V,E,c,s,t>$，$A \subset V$ 且 $s \in A$，$t \in \bar{A}$，称
$$
(A, \bar{A})=\{ <i,j> | <i, j>  \in E \ 且 \ i \in A,\ j \in \bar{A} \}
$$
为 $N$ 的**割集**，$c(A, \bar{A}) = \displaystyle \sum _ {<i, j> \in (A, \bar{A})}c(i, j)$ 为**割集 $(A, \bar{A})$ 的容量**。容量最小的割集称为**最小割集**。

**引理  7. 1**    设容量网络 $N = <V,E,c,s,t>$，$f$ 是 $N$ 上的任一**可行流**，$A \subset V$ 且 $s \in A$，$t \in \bar{A}$，则
$$
v(f)=\displaystyle \sum _ {<i,j> \in (A, \bar{A})}f(i, j)-\displaystyle \sum _ {<j,i> \in (\bar{A}, A)}f(j, i) \tag{7. 3}
$$
**引理  7. 2**    设容量网络 $N = <V,E,c,s,t>$，$f$ 是 $N$ 上的任一可行流，$(A, \bar{A})$ 是任一割集，则
$$
v(f) \leq c(A, \bar{A})
$$
**引理  7. 3**    设容量网络 $N = <V,E,c,s,t>$，$f$ 是 $N$ 上的一个可行流，$(A, \bar{A})$ 是一个割集，如果 $v(f) = c(A, \bar{A})$，则 $f$ 是最大流，$(A, \bar{A})$ 是最小割集。



###### $Ford-Fulkerson$ 算法

**定义  7. 3**    设容量网络 $N = <V,E,c,s,t>$，$f$ 是 $N$ 上的一个可行流。$N$ 中流量等于容量的边称为**饱和边**，流量小于容量的边称为**非饱和边**。流量等于 $0$ 的边称为**零流边**，流量大于 $0$ 的边称为**非零流边**。
        不考虑边的方向，$N$ 中从顶点 $i$ 到 $j$ 的一条边不重复的路径称为 $i$-$j$ **链**，$i$-$j$ 链的方向是从 $i$ 到 $j$。链中与链的方向一致的边称为**前向边**，与链的方向相反的边称为**后向边**。如果链中所有前向边都是非饱和的，所有后向边都是非零流的，则称这条链为 $i$-$j$ **增广链**。

**定理  7. 1**    可行流 $f$ 是最大流的充分必要条件是不存在关于 $f$ 的 $s$-$t$ 增广链。

**定理  7. 2  最大流最小割定理**    容量网络的最大流的流量等于最小割集的容量。

​			$Ford-Fulkerson$ 算法
1.  $f \leftarrow 0$
2.  $T \leftarrow \{ s \}$

```pseudocode
1. 
2. f <- 0 $f \leftarrow 0$

```

###### $Dinic$ 算法

**定义  7. 4**    设容量网络 $N=<V,E,c,s,t>$，$f$ 是 $N$ 上的可行流。定义关于 $f$ 的**辅助网络** $N(f)=<V,E,ac,s,t>$ 如下：
				$E^+(f)=\{ <i,j>|<i,j> \in E \ 且 \ f(i,j) < c(i, j) \}$
				$E^-(f)=\{ <j,i>|<i,j> \in E \ 且 \ f(i,j) > 0 \}$ 
				$E(f) = E^+(f) \cup E^-(f)$
				$ac(i,j) = \begin{cases} c(i,j) - f(i,j), & <i,j> \in E^+(f) \\ f(j,i), & <i,j> \in E^-(f) \end{cases}$ 
$ac$ 称为**辅助容量**，$N(f)$ 也是容量网络。

**引理  7. 4**    设 $N$ 的最大流量为 $v^*$，$f$ 是可行流，则 $N(f)$ 的最大流量为 $v^*-v(f)$.

**定义  7. 5**    设 $f$ 和 $g$ 分别是 $N$ 和 $N(f)$ 上的一个可行流，定义 $f'=f+g$ 如下：
$$
\forall <i,j> \in E,\quad f'(i,j)=f(i,j)+g(i,j)-g(j,i) \tag{7. 6}
$$
规定当 $<i,j> \notin E(f)$ 时，$g(i,j) = 0$.

**定理  7. 5**    设 $f$ 是 $N$ 上的一个可行流，$g$ 是 $N(f)$ 上的一个可行流，则 $f+g$ 是 $N$  上的可行流，且 $v(f+g)=v(f)+v(g)$.

**定义  7. 6**    设 $f$ 是容量网络 $N$ 中的可行流，关于 $f$ 的不含后向边的增广链称作**前向增广链**。如果不存在关于 $f$ 的 $s$-$t$ 前向增广链，则称 $f$ 是 $N$ 中的**极大流**。





##### 最小费用流

**定义  7. 7**    在容量网络 $N=<V,E,c,s,t>$ 中添加单位费用 $w:E \to R^*$，称作**容量-费用网络**，记作 $N=<V,E,c,w,s,t>$。
        设 $f$ 是 $N$ 上的一个可行流，称 $w (f) = \displaystyle \sum_{<i,j> \in E} w(i,j)f(i,j)$ 为 $f$ 的费用。在所有流量为 $v_0$ 的可行流中，费用最小的称作流量 $v_0$ 的**最小费用流**。

**最小费用流问题**    给定容量-费用网络 $N$ 和流量 $v_0$，求流量 $v_0$ 的最小费用流。

**命题  7. 1**    赋权有向图 $D=<V,E,w>$ 中任意两点之间都有最短路径或不存在路径当且仅当 $D$ 中不含负回路。

###### 最小费用流的负回路算法

​        设容量-费用网络 $N=<V,E,c,w,s,t>$，$f$ 是 $N$ 上的一个可行流，将定义 $7.$ $4$ 中关于 $f$ 的辅助网络 $N(f)$ 推广到容量-费用网络，记作 $N(f)=<V,E(f),ac,$$a\omega,$ $s,t>$，其中 $E(f)$ 和 $ac$ 不变，
$$
a\omega(i,j) = \begin{cases} \omega(i,j), & 若<i,j> \in E^+(f) \\ -\omega(j,i), & 若<i,j> \in E^-(f) \end{cases} \tag{7. 9}
$$
$a\omega$ 称为**辅助费用**。

**引理  7. 9**    设 $f$ 是容量-费用网络 $N$ 上的可行流，$g$ 是辅助网络 $N(f)$ 上的可行流，$f'=f+g$，则
$$
w(f') = w(f) + aw(g)
$$
**定义  7. 8**    设 $N=<V,E,c,w,s,t>$，$C$ 是 $N$ 中一条边不重复的回路，$E(C)$ 是 $C$ 的边集。$C$ 上的**圈流** $h^C$ 定义如下：$\forall <i,j> \in E(C)$，$h^C(i,j)=\delta$；$\forall <i,j>$ $\in$ $E - E(C)$，$h^C(i,j)=0$，其中 $\delta > 0$ 称为 $h^C$ 的**环流量**。
        显然，$h^C$ 是一个可行流，
$$
v(h^C)=0, \quad w(h^C)=\delta \cdot w(C)
$$
其中 $w(C) = \displaystyle \sum_{<i,j> \in E(C)}w(i,j)$.

**引理  7. 10**    设 $f_1,f_2$ 是 $N=<V,E,c,w,s,t>$ 上的两个可行流，$g=f_1-f_2$，则 $g$ 是 $N(f_2)$ 上的可行流且 $f_1=f_2+g$.

**引理  7. 11**    如果 $N$ 上的可行流 $f$ 不是零流且 $v(f)=0$，则 $f$ 等于若干个圈流之和。

**定理  7. 5**    设 $f$ 是 $N$ 上流量 $v_0$ 的可行流，则 $f$ 是最小费用流当且仅当 $N(f)$ 中不存在以辅助费用 $aw$ 为权的负回路。

​            最小费用流的负回路算法

1. 调用最大流算法，若求得流量 $v_0$ 的可行流 $f$，则转步骤 $2$；若最大流量小于 $v_0$，则输出“无流量 $v_0$ 的可行流”，计算结束。
2. 构造 $N(f)$.
3. 用 Floyd 算法检测 $N(f)$ 中是否存在权 $aw$ 的负回路。若存在负回路 $C$，则转步骤 $4$；若不存在负回路，则输出 $f$，计算结束。
4. 令 $\delta \leftarrow min\{ac(i,j)|<i,j> \in E(C) \}$
5. $\forall <i,j> \in E(C)$，若 $<i,j> \in E$，令 $f(i,j) \leftarrow f(i,j) + \delta$；若 $<i,j>$ $\in$ $E$，令 $f(j,i) \leftarrow f(j,i) - \delta$.
6. 转步骤 $2$ 



###### 最小费用流的最短路径算法

**引理  7. 12**    设有向图 $D=<V,E>$ 没有孤立点，顶点 $s$ 的出度比入度大 $1$，$t$ 的入度比出度大 $1$，其余顶点的出度等于入度，则 $D$ 可表成一条 $s$-$t$ 路径与若干条回路的并。

**定理  7. 6**    设 $f$ 是 $N$ 上的流量 $v_0$ 的最小费用流， $P$ 是 $N(f)$ 中权 $a\omega$ 的 $s$-$t$ 最短路径，$g$ 是 $P$ 上流量 $\theta$ 的可行流，则 $f'=f+g$ 是流量 $v_0+\theta$ 的最小费用流。

​            最小费用流的最短路径算法
1. $f \to 0$，$v \to v_0$
2. 构造 $N(f)$
3. 调用 $Floyd$ 算法计算 $N(f)$ 中以 $a\omega$ 为权的 $s$-$t$ 最短路径
4. if  $N(f)$ 中不存在 $s$-$t$ 路径  then​
5. ​        return  $“$无流量 $v_0$ 的可行流 $”$
6. else  设求得的最短路径为 $P$
7. $\theta \leftarrow min\{v, min\{ac(i,j)|<i,j> \in E(P) \} \}$  
8. for  $<i,j> \in E(P)$  do 
9. ​        if  $<i,j> \in E$ $then$ $f(i,j) \leftarrow f(j,i)+\theta$ 
10. ​        else  $f(j,i) \leftarrow f(j,i)-\theta$
11. $v \leftarrow v - \theta$
12. if  $v>0$  then  goto  2
13. return  $f$













